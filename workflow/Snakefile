#! /usr/bin/env python
# -*- coding: utf-8 -*-

from snakemake.utils import min_version
from os.path import splitext
import re

min_version("6.4.1")

configfile: "config/config.yaml"

wildcard_constraints:
    f = '[\w\-. ]+',
    fasta_base = '[\w\-. ]+\.(fasta|fa|fna)$'

include: "rules/remote.smk"
include: "rules/sequences.smk"
include: "rules/annotation.smk"
include: "rules/star_index.smk"


include: "rules/virus_annotation.smk"

localrules: latest_hg38, labref_hg38, all

rule latest_hg38:
    input:
        "databases/indexes/STAR_GRCh38.d1.vd1_gencode.v43"
    output:
        directory("databases/indexes/latest.hg38")
    shell:
        '''
ln -s ./$(basename {input[0]}) {output[0]}
        '''

rule labref_hg38:
    input:
        "databases/indexes/STAR_GRCh38.d1.vd1_gencode.v38"
    output:
        directory("databases/indexes/labref.hg38")
    shell:
        '''
ln -s ./$(basename {input[0]}) {output[0]}
        '''

rule all:
    input:
        rules.latest_hg38.output,
        rules.labref_hg38.output
